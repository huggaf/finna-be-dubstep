<section ng-controller="PostsCtrl" when-scrolled="nextPage()">

  <section class="post" ng-class="{'selected':post.selected}" ng-repeat="post in posts">
    <div class="title" ng-click="!post.edit && post.toggleSelect()" style="background-color:{{post.edit ? post.editElement.color : post.color}}">

      <div ng-hide="post.edit" ng-bind="post.title"></div>
      <input ng-show="post.edit" type="text" ng-model="post.editElement.title" class="form-control">

      <div class="author effect">
        <span class="info">&dash; {{post.author.name}} em <span title="{{post.created_at|date:'dd/MM/yyyy HH:mm:ss'}}">{{post.created_at|date:'dd/MM/yyyy'}}</span></span>
      </div>
    </div>

    <div class="content quick-effect">
      <div class="toolbar" ng-show="user.id == post.author.id">
        <i class="glyphicon glyphicon-edit effect" ng-click="post.editForm()" ng-hide="post.edit"></i>

        <div class="tools" ng-show="post.edit">
          <i class="glyphicon glyphicon-ok" ng-click="post.save()"></i>

          <i class="glyphicon glyphicon-remove" ng-click="post.cancelEditForm()"></i>

          <i class="glyphicon glyphicon-tint" style="color:{{color}}" ng-repeat="color in colors" ng-click="post.editElement.color = color"></i>

          <i class="glyphicon" ng-class="{'glyphicon-eye-close': !post.editElement.visible, 'glyphicon-eye-open': post.editElement.visible}" ng-click="post.editElement.visible = !post.editElement.visible"></i>

          <i class="glyphicon glyphicon-trash" ng-click="post.destroy()"></i>
        </div>


      </div>

      <div ng-hide="post.edit" ng-bind-html="post.text|markdown"></div>
      <div ng-show="post.edit">
        <textarea class="form-control" ng-model="post.editElement.text"></textarea>
        <a href="http://daringfireball.net/projects/markdown/basics" target="_blank">Sintaxe do markdown</a>
      </div>

    </div>
  </section>

  <div ng-show="loadMore">
    <button ng-hide="loadingPosts" class="btn btn-block btn-lg btn-info" ng-click="nextPage()">Carregar mais</button>
    <div ng-show="loadingPosts" class="text-center"><img src="/assets/loading.gif"> Carregando...</div>
  </div>
</section>

